<!DOCTYPE html>
<html lang="en">

<head>

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<meta name="description" content="AI Chat bot">
	<meta name="author" content="Africa LEO">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<title>Maximum Africa L.E.O &#8211; Africa&#039;s Catalyst for Prosperity and Innovation</title>

	<link rel="icon" href="img/FAVICON-1-300x300.png" sizes="32x32" />
	<link rel="icon" href="img/FAVICON-1-300x300.png" sizes="192x192" />
	<link rel="apple-touch-icon" href="img/FAVICON-1-300x300.png" />
	<meta name="msapplication-TileImage" content="img/FAVICON-1-300x300.png" />

	<script>
		if (!localStorage.frenify_skin) {
			localStorage.frenify_skin = 'dark';
		}
		if (!localStorage.frenify_panel) {
			localStorage.frenify_panel = '';
		}
		document.documentElement.setAttribute("data-techwave-skin", localStorage.frenify_skin);
		if (localStorage.frenify_panel !== '') {
			document.documentElement.classList.add(localStorage.frenify_panel);
		}

	</script>

	<!-- Google Fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
	<!-- !Google Fonts -->

	<!-- Styles -->
	<link type="text/css" rel="stylesheet" href="css/plugins.css?ver=1.0.0">
	<link type="text/css" rel="stylesheet" href="css/style.css?ver=1.0.0">
	<!--[if lt IE 9]> <script type="text/javascript" src="js/modernizr.custom.js"></script> <![endif]-->
	<!-- !Styles -->

</head>

<body>


	<!-- Moving Submenu -->
	<div class="techwave_fn_fixedsub">
		<ul></ul>
	</div>
	<!-- !Moving Submenu -->

	<!-- Preloader -->
	<div class="techwave_fn_preloader">
		<svg>
			<circle class="first_circle" cx="50%" cy="50%" r="110"></circle>
			<circle class="second_circle" cx="50%" cy="50%" r="110"></circle>
		</svg>
	</div>
	<!-- !Preloader -->



	<!-- MAIN WRAPPER -->
	<div class="techwave_fn_wrapper fn__has_sidebar">
		<div class="techwave_fn_wrap">


			<!-- !Searchbar -->


			<!-- LEFT PANEL -->
			<div class="techwave_fn_leftpanel">

				<div class="mobile_extra_closer"></div>

				<!-- logo (left panel) -->
				<div class="leftpanel_logo">
					<a href="index.html" class="fn_logo">
						<span class="full_logo">
							<img src="img/logo.png" alt="" class="desktop_logo">
							<img src="img/logo.png" alt="" class="retina_logo">
						</span>
						<span class="short_logo">
							<img src="img/FAVICON-1-300x300.png" alt="" class="desktop_logo">
							<img src="img/FAVICON-1-300x300.png" alt="" class="retina_logo">
						</span>
					</a>
					<a href="#" class="fn__closer fn__icon_button desktop_closer">
						<img src="svg/arrow.svg" alt="" class="fn__svg">
					</a>
					<a href="#" class="fn__closer fn__icon_button mobile_closer">
						<img src="svg/arrow.svg" alt="" class="fn__svg">
					</a>
				</div>
				<!-- !logo (left panel) -->

				<!-- content (left panel) -->
				<div class="leftpanel_content">

					<!-- #1 navigation group -->
					<div class="nav_group">
						<h2 class="group__title">Start Here</h2>
						<ul class="group__list">
							<li>
								<a href="#" class="fn__tooltip menu__item" data-position="right" title="Home">
									<span class="icon"><img src="svg/home.svg" alt="" class="fn__svg"></span>
									<span class="text">Home</span>
								</a>
							</li>

						</ul>
					</div>
					<!-- !#1 navigation group -->


				</div>
				<!-- !content (left panel) -->

			</div>
			<!-- !LEFT PANEL -->


			<!-- CONTENT -->
			<div class="techwave_fn_content">

				<!-- PAGE (all pages go inside this div) -->
				<div class="techwave_fn_page">

					<!-- AI Chat Bot Page -->
					<div class="techwave_fn_aichatbot_page fn__chatbot">

						<div class="chat__page">



							<div class="fn__title_holder">
								<div class="container">
									<!-- Active chat title -->
									<h1 class="title">Chat with Leo</h1>
									<!-- !Active chat title -->
								</div>
							</div>

							<div class="container">
								<div class="chat__list">

									<div id="chat0" class="chat__item"></div>

									<div class="chat__item active" id="chatBox"></div>

								</div>
							</div>


							<div class="chat__comment">
								<div class="container">
									<div class="fn__chat_comment">
										<div class="new__chat">
											<p>Ask it questions, engage in discussions, or simply enjoy a friendly chat.
											</p>
										</div>
										<textarea rows="1" class="fn__hidden_textarea" tabindex="-1"></textarea>
										<textarea rows="1" placeholder="Send a message..." id="userInput"></textarea>
										<button id="sendBtn"><img src="svg/enter.svg" alt="" class="fn__svg"></button>
									</div>
								</div>
							</div>

						</div>



					</div>
					<!-- !AI Chat Bot Page -->

				</div>
				<!-- !PAGE (all pages go inside this div) -->


				<!-- FOOTER (inside the content) -->
				<footer class="techwave_fn_footer">
					<div class="techwave_fn_footer_content">
						<div class="copyright">
							<p>2023© Maximum Africa L.E.O</p>
						</div>
						<div class="menu_items">
							<ul>
								<li><a href="#">Terms of Service</a></li>
								<li><a href="#">Privacy Policy</a></li>
							</ul>
						</div>
					</div>
				</footer>
				<!-- !FOOTER (inside the content) -->

			</div>
			<!-- !CONTENT -->


		</div>
	</div>
	<!-- !MAIN WRAPPER -->


	<script>
		document.addEventListener('DOMContentLoaded', () => {
			// Add a greeting message on page load
			const chatBox = document.getElementById('chatBox');
			const greetingMessage = `
			<div class="chat__box bot__chat">
                    <div class="author"><span>Leo</span></div>
                    <div class="chat">
                        <p class="bubble">Hello! I am Leo your AI assistant. How can I help you today?</p>
                    </div>
                </div>
        `;
			chatBox.insertAdjacentHTML('beforeend', greetingMessage);
		});

		async function fetchJsonData() {
			const response = await fetch('data/data.json');
			if (!response.ok) {
				throw new Error('Failed to load JSON data');
			}
			return await response.json();
		}

		async function getBotReply(query) {
			const apiKey = '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';
			const model = 'text-embedding-3-small';
			const jsonData = await fetchJsonData();

			// Generate embedding for the query
			const embeddingResponse = await fetch('https://api.openai.com/v1/embeddings', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					Authorization: `Bearer ${apiKey}`,
				},
				body: JSON.stringify({
					model,
					input: query,
				}),
			});

			const embeddingData = await embeddingResponse.json();
			const queryEmbedding = embeddingData.data[0].embedding;

			// Calculate similarity
			const cosineSimilarity = (vectorA, vectorB) => {
				const dotProduct = vectorA.reduce((sum, a, idx) => sum + a * vectorB[idx], 0);
				const magnitudeA = Math.sqrt(vectorA.reduce((sum, a) => sum + a ** 2, 0));
				const magnitudeB = Math.sqrt(vectorB.reduce((sum, b) => sum + b ** 2, 0));
				return dotProduct / (magnitudeA * magnitudeB);
			};

			const similarities = jsonData.map(chunk => ({
				chunk: chunk.content,
				similarity: cosineSimilarity(queryEmbedding, chunk.embedding),
			}));

			// Sort and get top matches
			similarities.sort((a, b) => b.similarity - a.similarity);
			const topMatches = similarities.slice(0, 3);

			// Check if any similarity score is above a threshold
			const threshold = 0.1; // You can adjust this threshold based on your needs
			if (topMatches[0].similarity < threshold) {
				return "Sorry, I couldn't find any relevant information. Can you please try rephrasing your question?";
			}

			// Send top matches to ChatGPT
			const response = await fetch('https://api.openai.com/v1/chat/completions', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					Authorization: `Bearer ${apiKey}`,
				},
				body: JSON.stringify({
					model: 'gpt-4o-mini',
					messages: [
						{
							role: 'system',
							content: 'You are a helpful assistant, do not reply with Based on the provided context just reply.'
						},
						{
							role: 'user',
							content: `Answer the user's question based on the provided context.\n\n` +
								`${topMatches.map(match => match.chunk).join('\n\n')}\n\nQuery: ${query}`,
						},
					],
					max_tokens: 500,
				}),
			});

			const result = await response.json();
			return result.choices[0].message.content;
		}

		function typingEffect(element, text, callback) {
			let index = 0;
			const interval = setInterval(() => {
				if (index < text.length) {
					element.textContent += text[index];
					index++;
				} else {
					clearInterval(interval);
					if (callback) callback();
				}
			}, 5); // Typing speed in milliseconds
		}

		// Chat functionality
		const chatBox = document.getElementById('chatBox');
		const userInput = document.getElementById('userInput');
		const sendBtn = document.getElementById('sendBtn');

		sendBtn.addEventListener('click', async () => {
			const query = userInput.value.trim();
			if (!query) return;

			// Display user query
			const userMessage = `
            <div class="chat__box your__chat" style="margin-top: 20px">
                    <div class="author"><span>You</span></div>
                    <div class="chat">
                        <p class="bubble">${query}</p>
                    </div>
            </div>
        `;
			chatBox.insertAdjacentHTML('beforeend', userMessage);
			userInput.value = '';

			// Add typing indicator
			const typingIndicator = document.createElement('div');
			typingIndicator.classList.add('chat-content');
			typingIndicator.innerHTML = `
            <div class="chat__box bot__chat">
                    <div class="author"><span>Leo</span></div>
                    <div class="chat">
                        <p class="bubble typing">Typing...</p>
                    </div>
                </div>
        `;
			chatBox.appendChild(typingIndicator);

			// Get bot reply
			const botReply = await getBotReply(query);

			// Remove typing indicator and add actual reply
			typingIndicator.remove();
			const botMessage = `
            <div class="chat__box bot__chat">
                    <div class="author"><span>Leo</span></div>
                    <div class="chat">
                        <p class="bubble"></p>
                    </div>
            </div>
        `;
			const botMessageElement = document.createElement('div');
			botMessageElement.innerHTML = botMessage;
			chatBox.appendChild(botMessageElement);

			// Typing effect for bot reply
			const bubble = botMessageElement.querySelector('.bubble');
			typingEffect(bubble, botReply);

			// Scroll to bottom
			chatBox.scrollTop = chatBox.scrollHeight;
		});

		document.getElementById('userInput').addEventListener('keydown', function (event) {
			if (event.key === 'Enter') {
				document.getElementById('sendBtn').click();
			}
		});
		document.getElementById('chatBox').scrollTop = document.getElementById('chatBox').scrollHeight;
	</script>


	<!-- Scripts -->
	<!-- <script type="text/javascript" src="js/jquery.js?ver=1.0.0"></script> -->
	<!-- <script type="text/javascript" src="js/plugins.js?ver=1.0.0"></script> -->
	<!--[if lt IE 10]> <script type="text/javascript" src="js/ie8.js"></script> <![endif]-->
	<!-- <script type="text/javascript" src="js/init.js?ver=1.0.0"></script> -->
	<!-- !Scripts -->

</body>

</html>